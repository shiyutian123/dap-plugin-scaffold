<ng-container *ngIf="pageType === 'planSet'">
    <div class="plansSet">
        <div nz-row class="showItem">
            <!-- <div nz-col nzSpan="6">
                    <span>基地：{{userInfo.base}}</span>
                </div> -->
            <div nz-col nzSpan="8">
                <span>组织：{{userInfo.orgName}}</span>
            </div>
            <div nz-col nzSpan="8">
                <span>工号：{{userInfo.userCode}}</span>
            </div>
            <div nz-col nzSpan="8">
                <span>姓名：{{userInfo.userName}}</span>
            </div>
        </div>

        <div nz-row class="planSet">
            <div class="setYear" nz-col nzSpan="2">
                <span class="showYear">{{year}}</span>
                <div class="set">
                    <i nz-icon type="caret-up" theme="outline" nzSize='small' (click)=addYear();></i>
                    <!-- <button style="margin-bottom: 5px;"  nz-button nzType="primary" nzSize='small'>
                                    <i nz-icon type="up" theme="outline"></i>
                            </button> -->
                    <!-- <button (click)=reduceYear(); nz-button nzType="primary" nzSize='small'>
                                    <i  nz-icon type="down" theme="outline"></i>
                            </button> -->
                    <i nz-icon type="caret-down" theme="outline" nzSize='small' (click)=reduceYear();></i>

                </div>
            </div>
            <div nz-col nzSpan="3">
                <nz-select [nzDisabled]="!isEdit" style="width: 120px;" [(ngModel)]="repeatValue"
                    nzAllowClear (ngModelChange)="repeatDate($event)">
                    <!-- <nz-option nzValue="oneWeek" nzLabel="一周/次"></nz-option>
                        <nz-option nzValue="twoWeek" nzLabel="两周/次"></nz-option>
                        <nz-option nzValue="oneMon" nzLabel="一月/次"></nz-option> -->
                    <ng-container *ngFor="let rate of userInfo.rates">
                        <nz-option [nzValue]="rate.code" [nzLabel]="rate.meaning"></nz-option>
                    </ng-container>
                </nz-select>
            </div>
            <div class="allSet" nz-col nzSpan="19">
                <div nz-col nzSpan="3" style="font-weight:bolder;">
                    批量填入
                </div>
                <div nz-col nzSpan="6">
                    <div nz-col nzSpan="4">班次：</div>
                    <div nz-col nzSpan="20">
                        <!-- classGroups -->
                        <nz-select nzShowSearch nzAllowClear [nzDisabled]="!isEdit" style="width: 80%;" [(ngModel)]="classesValue">
                            <ng-container *ngFor="let item of userInfo.workClasses">
                                <nz-option [nzValue]="item.code" [nzLabel]="item.meaning"></nz-option>
                            </ng-container>
                        </nz-select>
                    </div>
                </div>
                <div nz-col nzSpan="6">
                    <div nz-col nzSpan="4">工段：</div>
                    <div nz-col nzSpan="20">
                        <!-- workSections -->
                        <nz-select nzShowSearch nzAllowClear [nzDisabled]="!isEdit" style="width: 80%;" [(ngModel)]="workItemValue">
                            <ng-container *ngFor="let item of userInfo.workSections">
                                <nz-option [nzValue]="item.code" [nzLabel]="item.meaning"></nz-option>
                            </ng-container>
                        </nz-select>
                    </div>
                </div>
                <div nz-col nzSpan="6">
                    <div nz-col nzSpan="4">班组：</div>
                    <div nz-col nzSpan="20">
                        <nz-select nzShowSearch nzAllowClear [nzDisabled]="!isEdit" style="width: 80%;" [(ngModel)]="teamsValue">
                            <ng-container *ngFor="let item of userInfo.classGroups">
                                <nz-option [nzValue]="item.code" [nzLabel]="item.meaning"></nz-option>
                            </ng-container>
                        </nz-select>
                    </div>
                </div>
                <div nz-col nzSpan="3">
                    <button [disabled]="!isEdit" nz-button nzType="primary" (click)="addAllTable()">填入</button>
                </div>
            </div>
        </div>
        <div class="back">
            <div>
                <span class="page-tag title">{{pageTitle}}列表</span>
                <!-- <span class="separator" >|</span>
                        <span class="page-tag title" [ngClass]="{'active': pageType === 'planAll'}" (click)="queryPlan('planAll')">全部计划</span> -->
            </div>
            <div *ngIf="pageType === 'planSet'">
                <button nz-button nzType="primary" (click)="isEdit = true;">编辑</button>
                <button [disabled]="!isEdit" style="margin-left: 10px;margin-right: 20px;" nz-button nzType="primary"
                    (click)="save()">保存</button>
            </div>
            <!-- <div *ngIf="pageType === 'planAll'">
                        <button style="margin-left: 10px;margin-right: 20px;" nz-button nzType="primary" (click)="search()">查询</button>
                    </div> -->
        </div>
        <div class="showTable">
            <nz-table class="table" [nzSize]="'small'" #basicTable nzBordered [nzData]="planTableData"
                [nzShowPagination]="false" [nzScroll]="{ y: 'calc(100vh - 450px)' }">
                <thead>
                    <tr>
                        <th nzWidth="4%" style="min-width: 60px;">#</th>
                        <th nzWidth="11%">日期</th>
                        <th nzWidth="12%">班次</th>
                        <th nzWidth="12%">工段</th>
                        <th nzWidth="12%">班组</th>
                        <th nzWidth="12%">计划工位</th>
                        <th nzwidth="11%">实际工位</th>
                        <th nzWidth="11%">实际完成日期</th>
                        <th nzWidth="11%">执行状态</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let planItem of planTableData;let i = index;">
                        <td>{{i + 1}}</td>
                        <td>{{planItem.plan_date}}</td>
                        <td>
                            <ng-container *ngIf="planItem.exp">
                                <!-- <ng-container [ngStyle]="{'display' : planItem.exp ? 'block' : 'none'}"> -->
                                {{planItem.shift_name}}
                            </ng-container>
                            <ng-container *ngIf="!planItem.exp">
                                <!-- <ng-container [ngStyle]="{'display' : !planItem.exp ? 'block' : 'none'}"> -->
                                <ng-container *ngIf="!isEdit">
                                    <!-- <ng-container [ngStyle]="{'display' : !isEdit ? 'block' : 'none'}">     -->
                                    {{planItem.shift_name}}
                                </ng-container>
                                <!-- <nz-select [ngStyle]="{'display' : isEdit ? 'block' : 'none'}" nzShowSearch [nzDisabled]="!isEdit  || planItem.exp" style="width: 120px;" [(ngModel)]="planItem.shift"> -->
                                <nz-select *ngIf="isEdit" nzShowSearch nzAllowClear [nzDisabled]="!isEdit  || planItem.exp"
                                    style="width: 120px;" [(ngModel)]="planItem.shift">
                                    <ng-container *ngFor="let item of userInfo.workClasses">
                                        <nz-option [nzValue]="item.code" [nzLabel]="item.meaning"></nz-option>
                                    </ng-container>
                                </nz-select>
                            </ng-container>
                        </td>
                        <td>
                            <ng-container *ngIf="planItem.exp">
                                {{planItem.workshop_section_name}}
                            </ng-container>
                            <ng-container *ngIf="!planItem.exp">
                                <ng-container *ngIf="!isEdit">
                                    {{planItem.workshop_section_name}}
                                </ng-container>
                                <nz-select *ngIf="isEdit" nzShowSearch nzAllowClear [nzDisabled]="!isEdit  || planItem.exp"
                                    style="width: 120px;" [(ngModel)]="planItem.workshop_section">
                                    <ng-container *ngFor="let item of userInfo.workSections">
                                        <nz-option [nzValue]="item.code" [nzLabel]="item.meaning"></nz-option>
                                    </ng-container>
                                </nz-select>
                            </ng-container>
                        </td>
                        <td>
                            <ng-container *ngIf="planItem.exp">
                                {{planItem.team_name}}
                            </ng-container>
                            <ng-container *ngIf="!planItem.exp">
                                <ng-container *ngIf="!isEdit">
                                    {{planItem.team_name}}
                                </ng-container>
                                <nz-select *ngIf="isEdit" nzShowSearch nzAllowClear [nzDisabled]="!isEdit  || planItem.exp"
                                    style="width: 120px;" [(ngModel)]="planItem.team">
                                    <ng-container *ngFor="let item of userInfo.classGroups">
                                        <nz-option [nzValue]="item.code" [nzLabel]="item.meaning"></nz-option>
                                    </ng-container>
                                </nz-select>
                            </ng-container>
                        </td>
                        <td>
                            <ng-container *ngIf="planItem.exp">
                                {{planItem.station}}
                            </ng-container>
                            <ng-container *ngIf="!planItem.exp">
                                <ng-container *ngIf="!isEdit">
                                    {{planItem.station}}
                                </ng-container>
                                <!-- <nz-select *ngIf="false && isEdit" nzShowSearch [nzDisabled]="!isEdit || planItem.exp" style="width: 120px;" [(ngModel)]="planItem.station">
                                        <ng-container *ngFor="let item of userInfo.workcrs">
                                                <nz-option [nzValue]="item.WORKCR_CODE" [nzLabel]="item.WORKCR_CODE"></nz-option>
                                            </ng-container>
                                    </nz-select> -->

                                <nz-input-group *ngIf="isEdit" (click)="showModel(i)" style="width: 120px;"
                                    [nzSuffix]="suffixIconSearch">
                                    <input [disabled]="!isEdit || planItem.exp" type="text" nz-input placeholder="请选择工位"
                                        [(ngModel)]="planItem.station" />
                                </nz-input-group>
                                <ng-template #suffixIconSearch>
                                    <i nz-icon type="search"></i>
                                </ng-template>
                            </ng-container>
                        </td>
                        <td>{{planItem.real_station}}</td>
                        <td>{{planItem.finish_date}}</td>
                        <td>
                            <nz-tag *ngIf="planItem.execute_status === 'COMPLETE'" [nzColor]="'#87d068'">已完成</nz-tag>
                            <nz-tag *ngIf="planItem.execute_status === 'DELAY'" [nzColor]="'#f50'">延期完成</nz-tag>
                            <nz-tag *ngIf="planItem.execute_status === 'WAIT'" [nzColor]="'#108ee9'">待执行</nz-tag>
                            <nz-tag *ngIf="planItem.execute_status === 'DISTRIBUTE'" [nzColor]="'#ccc'">待分发</nz-tag>
                        </td>
                    </tr>
                </tbody>
            </nz-table>
        </div>
    </div>
</ng-container>

<nz-modal nzWidth="600" [(nzVisible)]="isVisible" nzTitle="选择计划工位" (nzOnCancel)="handleCancel()" (nzOnOk)="handleOk()">
    <nz-input-group nzSearch [nzSuffix]="suffixIconButton">
        <input type="text" [(ngModel)]="keyWord" name="keyWord" (ngModelChange)="modelChange()" nz-input placeholder="">
    </nz-input-group>
    <nz-table class="modalTable" #basicTable [nzData]="workcrsList" nzBordered [nzSize]="'small'"
        [nzFrontPagination]="false" [nzPageSizeOptions]="pageAll.pageSizeOptions" [nzPageSize]="pageAll.pageSize"
        [nzPageIndex]="pageAll.page" [nzTotal]="pageAll.pageTotal" [nzShowSizeChanger]="true"
        (nzPageSizeChange)="pageSizeChange($event)" (nzPageIndexChange)="pageIndexChange($event)"
        [nzShowTotal]='totalPage'>
        <thead>
            <tr>
                <th style="min-width: 60px;">#</th>
                <th>名称</th>
                <th>工位</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let workItem of workcrsList;let i = index" (click)="changeTr(i)"
                [ngClass]="{'tr-single-selected': workItem.checked === true}">
                <td [nzChecked]="true">{{i + 1}}</td>
                <td>{{workItem.WORKCR_DESC}}</td>
                <td [nzChecked]="true">{{workItem.WORKCR_CODE}}</td>
            </tr>
        </tbody>
    </nz-table>
</nz-modal>

<ng-template #suffixIconButton>
    <button nz-button nzType="primary" nzSearch (click)="query(keyWord)"><i nz-icon type="search"></i></button>
</ng-template>
<ng-template #totalPage>
    共{{pageAll.pageTotal}}条
</ng-template>